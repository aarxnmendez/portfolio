---
interface Props {
  lang?: "en" | "es";
}

const { lang = "en" }: Props = Astro.props;

const siteUrl: string = "http://localhost:4321";

// Dynamic SEO content
interface SeoData {
  title: string;
  description: string;
  keywords: string;
  canonical: string;
}

// Record<K, V> creates an object type with keys "en"|"es" and values of type SeoData
const seoData: Record<"en" | "es", SeoData> = {
  en: {
    title: "Aaron Mendez - Web Developer",
    description:
      "Web Developer with expertise in PHP, JavaScript, React, and modern web technologies. Currently studying Computer Engineering and building innovative web solutions.",
    keywords:
      "web developer, javascript, php, react, html, css, mysql, tailwind, astro, typescript, wordpress, git, portfolio",
    canonical: siteUrl,
  },
  es: {
    title: "Aaron Mendez - Desarrollador Web",
    description:
      "Desarrollador Web con experiencia en PHP, JavaScript, React y tecnologías web modernas. Estudiante de Ingeniería Informática creando soluciones web innovadoras.",
    keywords:
      "desarrollador web, javascript, php, react, html, css, mysql, tailwind, astro, typescript, wordpress, git, portfolio",
    canonical: siteUrl + "/es",
  },
};

const currentSeo: SeoData = seoData[lang];
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- Dynamic SEO Meta Tags -->
    <title>{currentSeo.title}</title>
    <meta name="description" content={currentSeo.description} />
    <meta name="keywords" content={currentSeo.keywords} />
    <meta name="robots" content="index,follow" />
    <meta name="author" content="Aaron Mendez" />

    <!-- Canonical URL -->
    <link rel="canonical" href={currentSeo.canonical} />

    <!-- Hreflang for multilingual -->
    <link rel="alternate" hreflang="en" href={siteUrl} />
    <link rel="alternate" hreflang="es" href={siteUrl + "/es"} />
    <link rel="alternate" hreflang="x-default" href={siteUrl} />
  </head>
  <body>
    <slot />
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>

<script>
  // Get stored language preference
  const storedLang = localStorage.getItem("language");
  const currentPath = window.location.pathname;
  const isInSpanishPath = currentPath.startsWith("/es");
  const currentLang = isInSpanishPath ? "es" : "en";

  if (storedLang === null) {
    // First visit - detect browser language
    const preferredLang = navigator.language.startsWith("es") ? "es" : "en";
    localStorage.setItem("language", preferredLang);

    // Only redirect if we're on the wrong URL
    if (preferredLang !== currentLang) {
      if (preferredLang === "es") {
        window.location.href = "/es";
      } else {
        window.location.href = "/";
      }
    }
  } else {
    // Subsequent visit - use stored preference
    if (storedLang !== currentLang) {
      if (storedLang === "es") {
        window.location.href = "/es";
      } else {
        window.location.href = "/";
      }
    }
  }
</script>
